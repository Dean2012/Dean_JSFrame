/**
 * wxy
 * 显示获得的宠物和装备 包括详细信息 不存在叠加 数量不能超过3个
 * 只是展示作用 数据加到库存不依赖这个window
 */
var TipWindow2 = cc.Node.extend({
	
	voList:null,
	itemList:null,
	box:null,
	
	ctor:function(p_voList)
	{
		this._super();
		this.voList = p_voList;
		this.initUI();
		this.initList();
		this.playAction();
	},
	
	initUI:function()
	{
		var blackMask = new cc.LayerColor(cc.color(1,1,1,128),cc.winSize.width,cc.winSize.height);
		blackMask.x = -cc.winSize.width / 2;
		blackMask.y = -cc.winSize.height / 2;
		this.addChild(blackMask,0);
		cc.eventManager.addListener({event: cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches: true,onTouchBegan: function (touch, event){return true;}}, blackMask);
		
		this.box = new cc.Node();
		this.addChild(this.box);
		
		var bg = Scale9SpriteFactory.winBgAngle(cc.winSize.width - 20,400);
		this.box.addChild(bg,1);
		
		var title = new TitleBarBase("恭喜获得");
		title.setFlip();
		title.y = 200;
		this.box.addChild(title, 2);
		
		var btn = new ButtonBase(null,"确定",this.close.bind(this));
		btn.y = -160;
		this.box.addChild(btn,3);
	},
	
	initList:function()
	{
		if( !this.voList || this.voList.length == 0){
			return;
		}
		this.itemList = [];
		for( var i = 0 ; i < this.voList.length ; i++ ){
			var vo = this.voList[i]
			var type = vo.uniqueId.split("_")[0] / 10000;
			type = type>>0;
			if(type == LoadXmlType.EQUIP){
				this.itemList.push(this.disEquip(vo));
			}else if(type == LoadXmlType.PET){
				this.itemList.push(this.disPet(vo));
			}
		}
		if( this.itemList.length == 2){
			this.itemList[0].x -= 130;
			this.itemList[1].x += 130;
		}else if( this.itemList.length == 3 ){
			this.itemList[1].x -= 190;
			this.itemList[2].x += 190;
		}
	},
	
	disPet:function(p_petVO)
	{
		var node = new cc.Node();
		var lampstand = new Lampstand(p_petVO.rebornLv,p_petVO.confXml.starLevel);
		lampstand.setScale(0.5);
		node.addChild(lampstand);
		var petBody = new cc.Sprite(resPet[p_petVO.confXml.bodyImg[p_petVO.rebornLv]]);
		petBody.setScale(0.5);
		petBody.y = 80;
		node.addChild(petBody);
		var petName = new LabelFonts(p_petVO.confXml.name[p_petVO.rebornLv],[{size:20,color:Util.getColorByQuality(p_petVO.confXml.starLevel)}],0.5);
		petName.y = -50;
		node.addChild(petName);
		var upText = new LabelFonts("成长：+" + p_petVO.evolveLv,[{size:20,color:MyColor.GREEN}],1);
		upText.updateX(-5);
		upText.y = -80;
		node.addChild(upText);
		var lvText = new LabelFonts("等级：" + p_petVO.lv,[{size:20,color:MyColor.ORANGE}],0);
		lvText.updateX(8);
		lvText.y = upText.y;
		node.addChild(lvText);
		this.box.addChild(node,4);
		return node;
	},
	
	disEquip:function(p_equipVO)
	{
		var node = new cc.Node();
		var icon = new EquipIcon(p_equipVO);
		icon.setScale(1.4);
		node.addChild(icon);
		var nameText = new LabelFonts(p_equipVO.confXml.name,[{size:20,color:Util.getColorByQuality(p_equipVO.confXml.starLevel)}],0.5);
		nameText.y = -100;
		node.addChild(nameText);
		var refineText = new LabelFonts("精炼：+" + p_equipVO.glv,[{size:20,color:MyColor.GREEN}],1);
		refineText.updateX(-5);
		refineText.y = -130;
		node.addChild(refineText);
		var lvText = new LabelFonts("等级：" + p_equipVO.lv,[{size:20,color:MyColor.ORANGE}],0);
		lvText.updateX(8);
		lvText.y = refineText.y;
		node.addChild(lvText);
		node.y = 50;
		this.box.addChild(node,4);
		return node;
	},
	
	playAction:function()
	{
		this.box.setScale(0);
		var action = cc.scaleTo(0.5, 1).easing(cc.easeElasticOut());
		this.box.runAction(action);
	},
	
	close:function()
	{
		this.removeFromParent(true);
	}
})